<% layout("/layouts/boilerplate") -%>

  <body>

    <% if(!user){ %>

      <h5 class="mt-3">Please Login</h5>

      <%}%>

        <style>
          #filters {
            padding: 5px;
            margin-top: 30px;
            overflow-x: auto;
            display: flex;
            align-items: center;
            gap: 20px;
            font-size: .9rem;
           

          }

          .filter {
            position: relative;
            cursor: pointer;
            opacity: 0.7;
            text-align: center;


          }

          .filter:hover::after {
            content: "";
            width: 100%;
            height: 2px;
            background-color: black;
            color: black;
            position: absolute;
            left: 0;
            transition: ease .3s;
            transform-origin: right;
          }

          .filter:hover {

            opacity: 1;
            transition: ease .3s;
          }
          .form-switch{

            border: solid 1px rgba(0, 0, 0, 0.281);
            padding: 1rem;
            border-radius: 1rem;
            margin-left: auto;
            padding-left: 1rem !important;
            padding-right: 3rem !important;


          }

          .tax-info{

            display: none;
          }
        </style>

        <div id="filters">

          <div class="filter">
            <div><i class="fa-solid fa-fire"></i></div>
            <p>Trending</p>
          </div>
          <div class="filter">
            <div><i class="fa-solid fa-bed"></i></div>
            <p>Rooms</p>
          </div>
          <div class="filter">
            <div><i class="fa-solid fa-mountain-city"></i></div>
            <p>Iconic Cities</p>
          </div>
          <div class="filter">
            <div><i class="fa-solid fa-mountain-sun"></i></div>
            <p>Mountains</p>
          </div>
          <div class="filter">
            <div><i class="fa-solid fa-chess-rook"></i></div>
            <p>Castels</p>
          </div>
          <div class="filter">
            <div><i class="fa-solid fa-person-swimming"></i></div>
            <p>Amazing Pools</p>
          </div>
          <div class="filter">
            <div><i class="fa-solid fa-campground"></i></div>
            <p>Camping</p>
          </div>
          <div class="filter">
            <div><i class="fa-solid fa-cow"></i></div>
            <p>Farms</p>
          </div>
          <div class="filter">
            <div><i class="fa-solid fa-snowflake"></i></div>
            <p>Arctic</p>
          </div>


          <div class="form-check-reverse form-switch">
            <input class="form-check-input toggleBtn" type="checkbox"  role="switch" id="switchCheckDefault">
            <label class="form-check-label" for="switchCheckDefault">Display total after tax</label>
          </div>

        </div>

        <div class="row row-cols-auto g-3">

          <% for (let listing of allListings) { %>
            <div class="col ">
              <a href="/listings/show/<%= listing._id %>" class="text-decoration-none text-dark">
                <div class="card listings-card" style="width: 26rem;">
                  <img src="<%= listing.image.url %>" class="card-img-top listing-card-img listing-card"
                    alt="<%= listing.title %>" title="<%= listing.title %>" style="height: 18rem; object-fit: cover;">

                  <div class="card-body ms-2">
                    <h5 style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                      <%= listing.title %>
                    </h5>

                    <span
                      style="display: flex; align-items: center; gap: 5px; font-size: 0.90rem; color: rgb(45, 45, 45);">
                      ₹<%= listing.price.toLocaleString("en-IN") %> per night

                        <% if (listing.reviews && listing.reviews.length> 0) { %>
                          <% let commentCount=listing.reviews.length; let maxComment=5; let ratingVal=commentCount>=
                            maxComment
                            ? 5.0
                            : (commentCount / maxComment) * 5;

                            ratingVal = Math.round(ratingVal * 10) / 10;
                            %>

                            • <span style="font-size: 0.80rem;">
                              <i class="fa-solid fa-star"></i> <b>
                                <%= ratingVal.toFixed(1) %> / 5.0 
                              </b>
                              
                            </span>
                            <% } %>

                           <i class="tax-info">+18 GST</i>
                    </span>
                  </div>
                </div>
              </a>
            </div>
            <% } %>

        </div>

  </body>

  <script>

    const toggleBtn = document.querySelector(".toggleBtn");
    const taxInfo = document.getElementsByClassName("tax-info");

    toggleBtn.addEventListener("click",() =>{

      for(tax of taxInfo){
  
        if(tax.style.display != "inline"){

          tax.style.display = "inline";
        }
        else{
          
          tax.style.display = "none";

        }
      }

    })
  </script>