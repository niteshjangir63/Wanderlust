<% layout("/layouts/boilerplate") -%>

  <body>

    <% if(!user){ %>

      <h5 class="mt-3">Please Login</h5>

      <%}%>

        <style>
          #filters {
          
          z-index: 9999;
           

          }

          .filter {
            position: relative;
            cursor: pointer;
            opacity: 0.7;
            text-align: center;
            margin: 10px;


          }


          .filter:hover {

            opacity: 1;
            transition: ease .3s;
          }
          .form-switch{

            border: solid 1px rgba(0, 0, 0, 0.281);
            padding: 1rem;
            border-radius: 1rem;
            margin-left: auto;
            padding-left: 1rem !important;
            padding-right: 3rem !important;


          }

          .tax-info{

            display: none;
          }
        </style>



<!-- Filters Section -->
<div class="container-fluid py-2 border-bottom d-flex justify-content-between align-items-center">

  <!-- Dropdown for Filters -->
  <div class="dropdown">
    <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="filtersDropdown" data-bs-toggle="dropdown" aria-expanded="false">
      Filters
    </button>
    <ul class="dropdown-menu p-3" aria-labelledby="filtersDropdown" style="min-width: 300px;">

      <div class="row row-cols-2 row-cols-sm-3 g-3">

        <div class="col text-center filter">
          <i class="fa-solid fa-fire fa-lg"></i>
          <p class="mb-0">Trending</p>
        </div>

        <div class="col text-center filter">
          <i class="fa-solid fa-bed fa-lg"></i>
          <p class="mb-0">Rooms</p>
        </div>

        <div class="col text-center filter">
          <i class="fa-solid fa-mountain-city fa-lg"></i>
          <p class="mb-0">Iconic Cities</p>
        </div>

        <div class="col text-center filter">
          <i class="fa-solid fa-mountain-sun fa-lg"></i>
          <p class="mb-0">Mountains</p>
        </div>

        <div class="col text-center filter">
          <i class="fa-solid fa-chess-rook fa-lg"></i>
          <p class="mb-0">Castels</p>
        </div>

        <div class="col text-center filter">
          <i class="fa-solid fa-person-swimming fa-lg"></i>
          <p class="mb-0">Pools</p>
        </div>

        <div class="col text-center filter">
          <i class="fa-solid fa-campground fa-lg"></i>
          <p class="mb-0">Camping</p>
        </div>

        <div class="col text-center filter">
          <i class="fa-solid fa-cow fa-lg"></i>
          <p class="mb-0">Farms</p>
        </div>

        <div class="col text-center filter">
          <i class="fa-solid fa-snowflake fa-lg"></i>
          <p class="mb-0">Arctic</p>
        </div>

      </div>
    </ul>
  </div>

  <!-- Toggle (always visible outside) -->
   <div class="form-check-reverse form-switch">
    <input class="form-check-input toggleBtn" type="checkbox" role="switch" id="switchCheckDefault">
    <label class="form-check-label ms-2" for="switchCheckDefault">Display total after tax</label>
  </div>

</div>





  


    

        <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4">

  <% for (let listing of allListings) { %>
    <div class="col">
      <a href="/listings/show/<%= listing._id %>" class="text-decoration-none text-dark">
        <div class="card listings-card h-100 shadow-sm">
          
          <!-- Image -->
          <img src="<%= listing.image.url %>" 
               class="card-img-top listing-card-img" 
               alt="<%= listing.title %>" 
               title="<%= listing.title %>" 
               style="height: 18rem; object-fit: cover;">

          <!-- Card Body -->
          <div class="card-body">
            <h5 class="card-title text-truncate"><%= listing.title %></h5>

            <span class="d-flex align-items-center gap-2 text-muted" style="font-size: 0.9rem;">
              ₹<%= listing.price.toLocaleString("en-IN") %> per night
              
              <% if (listing.reviews && listing.reviews.length > 0) { %>
                <% 
                  let commentCount = listing.reviews.length; 
                  let maxComment = 5; 
                  let ratingVal = commentCount >= maxComment ? 5.0 : (commentCount / maxComment) * 5;
                  ratingVal = Math.round(ratingVal * 10) / 10;
                %>

                • <span style="font-size: 0.85rem;">
                  <i class="fa-solid fa-star text-warning"></i> 
                  <b><%= ratingVal.toFixed(1) %> / 5.0</b>
                </span>
              <% } %>

              <span class="tax-info text-secondary">+18% GST</span>
            </span>
          </div>
        </div>
      </a>
    </div>
  <% } %>

</div>


  </body>

  <script>

    const toggleBtn = document.querySelector(".toggleBtn");
    const taxInfo = document.getElementsByClassName("tax-info");

    toggleBtn.addEventListener("click",() =>{

      for(tax of taxInfo){
  
        if(tax.style.display != "inline"){

          tax.style.display = "inline";
        }
        else{
          
          tax.style.display = "none";

        }
      }

    })
  </script>